{% extends 'base.html' %}
{% load static %}
{% load myfilters %}
{% block content %}

<form action="" method="post">{% csrf_token %}
	<p>{{ userlist_form.title|addclass:'input_class main centered' }}</p>
	
	<div class="list">
	{% for item in item_formset %}
		<div class="num">
		
		<!-- some nerd styling option -->
		{% if item.status.value == "done" %}
		{{ item.inner_order|addclass:'digits done' }}
		{% elif item.status.value == "in_progress" %}
		{{ item.inner_order|addclass:'digits in_progress' }}
		{% else %}
		{{ item.inner_order|addclass:'digits planned' }}
		{% endif %}
		
		{{ item.status|addclass:'status_style' }}
		<div class="item_style">{{ item.text|addclass:'input_class disable_drag' }}<h5>В последний раз обновлено в {{ item.updated_datetime.value }} пользователем {{ item.last_update_author.value }}</h5></div>
		<div class="num_control">
			<div class="delete-row color_button" id={{ item.inner_order.value}}>Цвет</div>
			<!-- here is delete button -->
		</div>
		</div>
	{% endfor %}
	</div>
	<!-- <p>Описание: {{ userlist_form.description }}</p> -->
	<p class="centered more_padding">В последний раз список обновлен пользователем {{ userlist_form.last_update_author.value }} в {{ userlist_form.updated_datetime.value }}</p>
	{{ item_formset.management_form  }}
	{% if access_level >= 2 %}
	<p class="centered"><input type="submit" value="Сохранить"></p>
	{% endif %}
	
	
</form>


<!-- Include formset plugin - including jQuery dependency -->
{% if access_level > 2 %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="{% static 'js/jquery.formset.js' %}"></script>
<script>
    $('.num').formset({
        deleteText: 'Удалить',
		deleteContainerClass: 'num_control', 
		addText: 'Добавить пункт',
    });
	$("textarea").autoHeight()
	
	$('.disable_drag')
        .on('focus', function(e) {
            $(this).closest('.num').attr("draggable", false);
        })
        .on('blur', function(e) {
            $(this).closest('.num').attr("draggable", true);
		})
		
	$(document)
        .on('click', '.color_button', function(e) {
            if ($(this).parent().siblings('.status_style').val()=="planned"){
				$(this).parent().siblings('.status_style').val("in_progress")
				$(this).parent().siblings('.digits').removeClass("planned")
				$(this).parent().siblings('.digits').addClass("in_progress")}
			else if ($(this).parent().siblings('.status_style').val()=="in_progress"){
				$(this).parent().siblings('.status_style').val("done")
				$(this).parent().siblings('.digits').removeClass("in_progress")
				$(this).parent().siblings('.digits').addClass("done")}
			else if ($(this).parent().siblings('.status_style').val()=="done"){
				$(this).parent().siblings('.status_style').val("planned")
				$(this).parent().siblings('.digits').removeClass("done")
				$(this).parent().siblings('.digits').addClass("planned")}

        })

</script>
{% endif %}
{% endblock content %}